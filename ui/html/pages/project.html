{{define "title"}}Project - {{.Project.Name}}{{end}}

{{define "main"}}
    <div class="context-info">
        <p class="text-muted">Client: <a href="/client/view/{{.Client.ID}}" class="context-link"><strong>{{.Client.Name}}</strong></a></p>
    </div>

    <div class="client">
        <div class="metadata-header">
            <strong>{{.Project.Name}}</strong>
            <span>#{{.Project.ID}}</span>
        </div>
        <div class="client-details-header">
            <button id="toggle-details" class="btn-toggle-details">
                <span id="toggle-icon">‚ñ∂</span> Details
            </button>
        </div>
        <div class="client-details hidden" id="client-details">
            <div class="client-info">
                <p><strong>Status:</strong> {{.Project.Status}}</p>
                <p><strong>Hourly Rate:</strong> ${{printf "%.2f" .Project.HourlyRate}}</p>
                
                {{if .Project.Deadline}}<p><strong>Deadline:</strong> {{.Project.Deadline.Format "2006-01-02"}}</p>{{end}}
                {{if .Project.ScheduledStart}}<p><strong>Scheduled Start:</strong> {{.Project.ScheduledStart.Format "2006-01-02"}}</p>{{end}}
                
                {{if .Project.InvoiceCCEmail}}<p><strong>Invoice CC Email:</strong> {{.Project.InvoiceCCEmail}}</p>{{end}}
                {{if .Project.InvoiceCCDescription}}<p><strong>Invoice CC Description:</strong> {{.Project.InvoiceCCDescription}}</p>{{end}}
                
                {{if .Project.ScheduleComments}}<p><strong>Schedule Comments:</strong><br>{{.Project.ScheduleComments}}</p>{{end}}
            </div>
            
            <div class="client-billing">
                <p><strong>Currency:</strong> {{.Project.CurrencyDisplay}}</p>
                <p><strong>Currency Conversion Rate:</strong> {{printf "%.5f" .Project.CurrencyConversionRate}}</p>
                <p><strong>Flat Fee Invoice:</strong> {{if .Project.FlatFeeInvoice}}Yes{{else}}No{{end}}</p>
                
                {{if .Project.DiscountPercent}}<p><strong>Discount:</strong> {{printf "%.4f" .Project.DiscountPercent}}</p>{{end}}
                {{if .Project.DiscountReason}}<p><strong>Discount Reason:</strong> {{.Project.DiscountReason}}</p>{{end}}
                
                {{if .Project.AdjustmentAmount}}<p><strong>Adjustment:</strong> ${{printf "%.2f" .Project.AdjustmentAmount}}</p>{{end}}
                {{if .Project.AdjustmentReason}}<p><strong>Adjustment Reason:</strong> {{.Project.AdjustmentReason}}</p>{{end}}
            </div>
            
            {{if or .Project.Notes .Project.AdditionalInfo .Project.AdditionalInfo2}}
            <div class="client-notes">
                <h3>Additional Information</h3>
                {{if .Project.AdditionalInfo}}<div><strong>Additional Info:</strong><br>{{.Project.AdditionalInfo}}</div>{{end}}
                {{if .Project.AdditionalInfo2}}<div><strong>Additional Info 2:</strong><br>{{.Project.AdditionalInfo2}}</div>{{end}}
                {{if .Project.Notes}}<div><strong>Notes:</strong><br>{{.Project.Notes}}</div>{{end}}
            </div>
            {{end}}
        </div>
        <div class="client-actions">
            <a href="/project/update/{{.Project.ID}}" class="btn-client-action">Edit Project</a>
            <form method="POST" action="/project/delete/{{.Project.ID}}" class="delete-form">
                <button type="submit" class="btn-client-action btn-delete">Delete Project</button>
            </form>
        </div>
        <div class="metadata-footer">
            <time>{{.Project.Updated | humanDate | printf "Updated: %s"}}</time>
            <time>Created: {{humanDate .Project.Created}}</time>
        </div>
    </div>
    
    <div class="projects-section">
        <div class="projects-header">
            <h3>Timesheets</h3>
            <a href="/project/{{.Project.ID}}/timesheet/create" class="btn-add-project" title="Add new timesheet">
                ‚ûï Add Timesheet
            </a>
        </div>
        
        {{if .Timesheets}}
            <div class="projects-list">
                {{range .Timesheets}}
                    <div class="project-item">
                        <div class="project-content">
                            <div class="project-info">
                                <strong class="project-name">{{.WorkDate.Format "2006-01-02"}}</strong>
                                <span class="project-id">{{printf "%.2f" .HoursWorked}} hours @ ${{printf "%.2f" .HourlyRate}}/hr</span>
                            </div>
                            <div class="action-buttons">
                                <a href="/timesheet/update/{{.ID}}" class="btn-icon btn-edit" title="Edit timesheet">
                                    ‚úèÔ∏è
                                </a>
                                <form method="POST" action="/timesheet/delete/{{.ID}}">
                                    <button type="submit" class="btn-icon btn-delete" title="Delete timesheet">
                                        üóëÔ∏è
                                    </button>
                                </form>
                            </div>
                        </div>
                        {{if .Description}}
                        <div class="description-divider">
                            <p class="description-text">{{.Description}}</p>
                        </div>
                        {{end}}
                        <div class="project-meta">
                            <time>{{.Updated | humanDate | printf "Updated: %s"}}</time>
                            <time>Created: {{humanDate .Created}}</time>
                        </div>
                    </div>
                {{end}}
            </div>
        {{else}}
            <div class="projects-empty">
                <p class="empty-message">No timesheets yet.</p>
                <p class="empty-action"><a href="/project/{{.Project.ID}}/timesheet/create">Add the first timesheet</a></p>
            </div>
        {{end}}
    </div>
    
    <div class="projects-section">
        <div class="projects-header">
            <h3>Invoices</h3>
            <a href="/project/{{.Project.ID}}/invoice/create" class="btn-add-project" title="Add new invoice">
                ‚ûï Add Invoice
            </a>
        </div>
        
        {{if .Invoices}}
            <div class="projects-list">
                {{range .Invoices}}
                    <div class="project-item">
                        <div class="project-content">
                            <div class="project-info">
                                <strong class="project-name">${{printf "%.2f" .AmountDue}}</strong>
                                <span class="project-id">{{.InvoiceDate.Format "2006-01-02"}}</span>
                            </div>
                            <div class="action-buttons">
                                <a href="/invoice/print/{{.ID}}" class="btn-icon btn-print" title="Print invoice PDF">
                                    üñ®Ô∏è
                                </a>
                                <a href="/invoice/update/{{.ID}}" class="btn-icon btn-edit" title="Edit invoice">
                                    ‚úèÔ∏è
                                </a>
                                <form method="POST" action="/invoice/delete/{{.ID}}">
                                    <button type="submit" class="btn-icon btn-delete" title="Delete invoice">
                                        üóëÔ∏è
                                    </button>
                                </form>
                            </div>
                        </div>
                        <div class="description-divider">
                            <p class="description-text">
                                Payment Terms: {{.PaymentTerms}}
                                {{if .DatePaid}}
                                    | <span class="status-paid">Paid: {{.DatePaid.Format "2006-01-02"}}</span>
                                {{else}}
                                    | <span class="status-unpaid">Unpaid</span>
                                {{end}}
                                | Display Details: {{if .DisplayDetails}}<span class="status-paid">Yes</span>{{else}}<span class="status-neutral">No</span>{{end}}
                            </p>
                        </div>
                        <div class="project-meta">
                            <time>{{.Updated | humanDate | printf "Updated: %s"}}</time>
                            <time>Created: {{humanDate .Created}}</time>
                        </div>
                    </div>
                {{end}}
            </div>
        {{else}}
            <div class="projects-empty">
                <p class="empty-message">No invoices yet.</p>
                <p class="empty-action"><a href="/project/{{.Project.ID}}/invoice/create">Add the first invoice</a></p>
            </div>
        {{end}}
    </div>
{{end}}